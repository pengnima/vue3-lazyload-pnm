/*!
 * Vue3-Lazyload.js v0.0.6
 * A Vue3.x image lazyload plugin
 * (c) 2021 PengNima 
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).VueLazyload=e()}(this,function(){"use strict";var o,t;(t={}).mounted="mounted",t.error="error",(t=o=o||{}).LAZYING="lazying",t.LAZYED="lazyed",t.ERROR="error";var n=(e.prototype._setImgSrc=function(t,e,i){t.setAttribute("src",e),t.setAttribute("lazy",i)},e.prototype._imgLoadEvent=function(t,e){t.onload=null;var i=document.body.scrollTop||document.documentElement.scrollTop;this._imgInScreenCheck(t,e,i)},e.prototype._newImgLoadEvent=function(t,e){var i;t.onload=null,t.setAttribute("lazy",o.LAZYED),null!==(i=this.options.lifeCycle)&&void 0!==i&&i.mounted&&this.options.lifeCycle.mounted(t,e)},e.prototype._imgErrorEvent=function(t,e){var i;this.destory(t),null!==(i=this.options.lifeCycle)&&void 0!==i&&i.error&&this.options.lifeCycle.error(t,e)},e.prototype._imgInScreenCheck=function(e,t,i){if(i+window.innerHeight>e.offsetTop){e.onload=this._newImgLoadEvent.bind(this,e,t),e.setAttribute("src",t.value);t=this._imgList.findIndex(function(t){return t.el===e});return this._imgList.splice(t,1)}this._io.observe(e)},e.prototype.init=function(t,e){t.onload=this._imgLoadEvent.bind(this,t,e),t.onerror=this._imgErrorEvent.bind(this,t,e),this._imgList.push({el:t,binding:e}),this._setImgSrc(t,this.options.loading,o.LAZYING)},e.prototype.destory=function(e){this._io.unobserve(e);var t=this._imgList.findIndex(function(t){return t.el===e});0<=t&&this._imgList.splice(t,1)},e);function e(t){var o=this;this.options={loading:"",lifeCycle:{}},this.options=Object.assign(this.options,t),this._imgList=[],this._io=new IntersectionObserver(function(t){Array.prototype.forEach.call(t,function(t){if(0<t.intersectionRatio)for(var e=o._imgList.length-1;0<=e;e--){var i=o._imgList[e];i.el===t.target&&(i.el.onload=o._newImgLoadEvent.bind(o,i.el,i.binding),i.el.setAttribute("src",i.binding.value),o.destory(i.el))}})})}return{install:function(t,e){e=Object.assign({},e);var i=new n(e);t.directive("lazy",{mounted:function(t,e){if("img"!==t.nodeName.toLocaleLowerCase())throw new Error("在非img标签上使用了 v-lazy");i.init(t,e)},beforeUpdate:function(t,e){e.oldValue!=e.value&&(i.destory(t),i.init(t,e))}})}}});
