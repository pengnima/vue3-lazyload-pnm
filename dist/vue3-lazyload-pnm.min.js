/*!
 * Vue3-Lazyload.js v0.0.6
 * A Vue3.x image lazyload plugin
 * (c) 2021 PengNima 
 * Released under the MIT License.
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).VueLazyload=i()}(this,function(){"use strict";var o,t;(t={}).mounted="mounted",t.error="error",(t=o=o||{}).LAZYING="lazying",t.LAZYED="lazyed",t.ERROR="error";var n=(i.prototype._setImgSrc=function(t,i,e){t.setAttribute("src",i),t.setAttribute("lazy",e)},i.prototype._imgLoadEvent=function(t,i){t.onload=null;var e=document.body.scrollTop||document.documentElement.scrollTop;this._imgInScreenCheck(t,i,e)},i.prototype._newImgLoadEvent=function(t,i){var e;t.onload=null,t.setAttribute("lazy",o.LAZYED),null!==(e=this.options.lifeCycle)&&void 0!==e&&e.mounted&&this.options.lifeCycle.mounted(t,i)},i.prototype._imgErrorEvent=function(t,i){var e;this.destory(t),null!==(e=this.options.lifeCycle)&&void 0!==e&&e.error&&this.options.lifeCycle.error(t,i)},i.prototype._imgInScreenCheck=function(i,t,e){if(e+window.innerHeight>i.offsetTop){i.onload=this._newImgLoadEvent.bind(this,i,t),i.setAttribute("src",t.value);t=this._imgList.findIndex(function(t){return t.el===i});return this._imgList.splice(t,1)}this._io.observe(i)},i.prototype.init=function(t,i){t.onload=this._imgLoadEvent.bind(this,t,i),t.onerror=this._imgErrorEvent.bind(this,t,i),this._imgList.push({el:t,binding:i}),this._setImgSrc(t,this.options.loading,o.LAZYING)},i.prototype.destory=function(i){this._io.unobserve(i);var t=this._imgList.findIndex(function(t){return t.el===i});0<=t&&this._imgList.splice(t,1)},i);function i(t){var o=this;this.options={loading:"",lifeCycle:{}},this.options=Object.assign(this.options,t),this._imgList=[],this._io=new IntersectionObserver(function(t){Array.prototype.forEach.call(t,function(t){if(0<t.intersectionRatio)for(var i=o._imgList.length-1;0<=i;i--){var e=o._imgList[i];e.el===t.target&&(e.el.onload=o._newImgLoadEvent.bind(o,e.el,e.binding),e.el.setAttribute("src",e.binding.value),o.destory(e.el))}})})}return{install:function(t,i){i=Object.assign({},i);var e=new n(i);t.directive("lazy",{mounted:function(t,i){if("img"!==t.nodeName.toLocaleLowerCase())throw new Error("在非img标签上使用了 v-lazy");e.init(t,i)},updated:function(t,i){i.oldValue!=i.value&&(e.destory(t),e.init(t,i))}})}}});
