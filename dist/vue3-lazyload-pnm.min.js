/*!
 * Vue3-Lazyload.js v0.0.5
 * A Vue3.x image lazyload plugin
 * (c) 2021 PengNima 
 * Released under the MIT License.
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).VueLazyload=i()}(this,function(){"use strict";var n,t;(t={}).mounted="mounted",t.error="error",(t=n=n||{}).LAZYING="lazying",t.LAZYED="lazyed",t.ERROR="error";var o=(i.prototype._setImgSrc=function(t,i,e){t.setAttribute("src",i),t.setAttribute("lazy",e)},i.prototype._imgLoadEvent=function(t,i){t.onload=null;var e=document.body.scrollTop||document.documentElement.scrollTop;this._imgInScreenCheck(t,i,e)},i.prototype._newImgLoadEvent=function(t,i){var e;t.onload=null,t.setAttribute("lazy",n.LAZYED),null!==(e=this.options.lifeCycle)&&void 0!==e&&e.mounted&&this.options.lifeCycle.mounted(t,i)},i.prototype._imgErrorEvent=function(i,t){var e=this._imgList.findIndex(function(t){return t.el===i});this._imgList.splice(e,1),null!==(e=this.options.lifeCycle)&&void 0!==e&&e.error&&this.options.lifeCycle.error(i,t)},i.prototype._imgInScreenCheck=function(i,t,e){if(e+window.innerHeight>i.offsetTop){i.onload=this._newImgLoadEvent.bind(this,i,t),i.setAttribute("src",t.value);t=this._imgList.findIndex(function(t){return t.el===i});return this._imgList.splice(t,1)}this._io.observe(i)},i.prototype.init=function(t,i){t.onload=this._imgLoadEvent.bind(this,t,i),t.onerror=this._imgErrorEvent.bind(this,t,i),this._imgList.push({el:t,binding:i}),this._setImgSrc(t,this.options.loading,n.LAZYING)},i);function i(t){var n=this;this.options={loading:"",lifeCycle:{}},this.options=Object.assign(this.options,t),this._imgList=[],this._io=new IntersectionObserver(function(t){Array.prototype.forEach.call(t,function(t){if(0<t.intersectionRatio)for(var i=n._imgList.length-1;0<=i;i--){var e=n._imgList[i];e.el===t.target&&(e.el.onload=n._newImgLoadEvent.bind(n,e.el,e.binding),e.el.setAttribute("src",e.binding.value),n._io.unobserve(e.el),n._imgList.splice(i,1))}})})}return{install:function(t,i){i=Object.assign({},i);var e=new o(i);t.directive("lazy",{mounted:function(t,i){if("img"!==t.nodeName.toLocaleLowerCase())throw new Error("在非img标签上使用了 v-lazy");e.init(t,i)}})}}});
