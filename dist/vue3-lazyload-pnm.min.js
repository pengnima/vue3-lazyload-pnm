/*!
 * Vue3-Lazyload.js v0.0.4
 * A Vue3.x image lazyload plugin
 * (c) 2021 PengNima 
 * Released under the MIT License.
 */
!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(i="undefined"!=typeof globalThis?globalThis:i||self).VueLazyload=t()}(this,function(){"use strict";var o,i;(i={}).mounted="mounted",i.error="error",(i=o=o||{}).LAZYING="lazying",i.LAZYED="lazyed",i.ERROR="error";var n=(t.prototype._setImgSrc=function(i,t,e){i.setAttribute("src",t),i.setAttribute("lazy",e)},t.prototype._imgLoadEvent=function(i,t){i.onload=null;var e=document.body.scrollTop||document.documentElement.scrollTop;this._imgInScreenCheck(i,t,e)},t.prototype._newImgLoadEvent=function(i,t){var e;(i.onload=null)!==(e=this.options.lifeCycle)&&void 0!==e&&e.mounted&&this.options.lifeCycle.mounted(i,t)},t.prototype._imgErrorEvent=function(t,i){var e=this._imgList.findIndex(function(i){return i.el===t});this._imgList.splice(e,1),null!==(e=this.options.lifeCycle)&&void 0!==e&&e.error&&this.options.lifeCycle.error(t,i)},t.prototype._imgInScreenCheck=function(t,i,e){if(e+window.innerHeight>t.offsetTop){t.onload=this._newImgLoadEvent.bind(this,t,i),this._setImgSrc(t,i.value,o.LAZYED);i=this._imgList.findIndex(function(i){return i.el===t});return this._imgList.splice(i,1)}this._io.observe(t)},t.prototype.init=function(i,t){i.onload=this._imgLoadEvent.bind(this,i,t),i.onerror=this._imgErrorEvent.bind(this,i,t),this._imgList.push({el:i,binding:t}),this._setImgSrc(i,this.options.loading,o.LAZYING)},t);function t(i){var n=this;this.options={loading:"",lifeCycle:{}},this.options=Object.assign(this.options,i),this._imgList=[],this._io=new IntersectionObserver(function(i){Array.prototype.forEach.call(i,function(i){if(0<i.intersectionRatio)for(var t=n._imgList.length-1;0<=t;t--){var e=n._imgList[t];e.el===i.target&&(e.el.onload=n._newImgLoadEvent.bind(n,e.el,e.binding),n._setImgSrc(e.el,e.binding.value,o.LAZYED),n._io.unobserve(e.el),n._imgList.splice(t,1))}})})}return{install:function(i,t){t=Object.assign({},t);var e=new n(t);i.directive("lazy",{mounted:function(i,t){if("img"!==i.nodeName.toLocaleLowerCase())throw new Error("在非img标签上使用了 v-lazy");e.init(i,t)}})}}});
